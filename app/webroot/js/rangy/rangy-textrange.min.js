(function(b,a){if(typeof define=="function"&&define.amd){define(["./rangy-core"],b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b(require("rangy"))}else{b(a.rangy)}}})(function(a){a.createModule("TextRange",["WrappedSelection"],function(v,aD){var D="undefined";var L="character",j="word";var A=v.dom,an=v.util;var ab=an.extend;var s=an.createOptions;var aB=A.getBody;var n=/^[ \t\f\r\n]+$/;var ap=/^[ \t\f\r]+$/;var ai=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/;var Q=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/;var E=/^[\n-\r\u0085\u2028\u2029]$/;var av="en";var ax=v.Selection.isDirectionBackward;var p=false;var at=false;var al=false;var l=true;(function(){var aJ=A.createTestElement(document,"<p>1 </p><p></p>",true);var aL=aJ.firstChild;var aK=v.getSelection();aK.collapse(aL.lastChild,2);aK.setStart(aL.firstChild,0);p=(""+aK).length==1;aJ.innerHTML="1 <br />";aK.collapse(aJ,2);aK.setStart(aJ.firstChild,0);at=(""+aK).length==1;aJ.innerHTML="1 <p>1</p>";aK.collapse(aJ,2);aK.setStart(aJ.firstChild,0);al=(""+aK).length==1;A.removeNode(aJ);aK.removeAllRanges()})();function d(aO,aL){var aJ=aO.join(""),aR,aN=[];function aM(aY,aT,aX){var aW=aO.slice(aY,aT);var aV={isWord:aX,chars:aW,toString:function(){return aW.join("")}};for(var aU=0,aS=aW.length;aU<aS;++aU){aW[aU].token=aV}aN.push(aV)}var aK=0,aQ,aP;while((aR=aL.wordRegex.exec(aJ))){aQ=aR.index;aP=aQ+aR[0].length;if(aQ>aK){aM(aK,aQ,false)}if(aL.includeTrailingSpace){while(Q.test(aO[aP])){++aP}}aM(aQ,aP,true);aK=aP}if(aK<aO.length){aM(aK,aO.length,false)}return aN}var aA={includeBlockContentTrailingSpace:true,includeSpaceBeforeBr:true,includeSpaceBeforeBlock:true,includePreLineTrailingSpace:true,ignoreCharacters:""};function S(aL){var aJ=aL||"";var aK=(typeof aJ=="string")?aJ.split(""):aJ;aK.sort(function(aN,aM){return aN.charCodeAt(0)-aM.charCodeAt(0)});return aK.join("").replace(/(.)\1+/g,"$1")}var aH={includeBlockContentTrailingSpace:!l,includeSpaceBeforeBr:!at,includeSpaceBeforeBlock:!al,includePreLineTrailingSpace:true};var u={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:false,tokenizer:d}};var T={caseSensitive:false,withinRange:null,wholeWordsOnly:false,wrap:false,direction:"forward",wordOptions:null,characterOptions:null};var af={wordOptions:null,characterOptions:null};var ar={wordOptions:null,characterOptions:null,trim:false,trimStart:true,trimEnd:true};var I={wordOptions:null,characterOptions:null,direction:"forward"};function V(aJ){var aL,aK;if(!aJ){return u[av]}else{aL=aJ.language||av;aK={};ab(aK,u[aL]||u[av]);ab(aK,aJ);return aK}}function aj(aJ,aL){var aK=s(aJ,aL);if(aL.hasOwnProperty("wordOptions")){aK.wordOptions=V(aK.wordOptions)}if(aL.hasOwnProperty("characterOptions")){aK.characterOptions=s(aK.characterOptions,aA)}return aK}var ac=A.getComputedStyleProperty;var ao;(function(){var aK=document.createElement("table");var aJ=aB(document);aJ.appendChild(aK);ao=(ac(aK,"display")=="block");aJ.removeChild(aK)})();v.features.tableCssDisplayBlock=ao;var r={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};function H(aK,aM){var aL=ac(aK,"display",aM);var aJ=aK.tagName.toLowerCase();return(aL=="block"&&ao&&r.hasOwnProperty(aJ))?r[aJ]:aL}function U(aM){var aL=g(aM);for(var aK=0,aJ=aL.length;aK<aJ;++aK){if(aL[aK].nodeType==1&&H(aL[aK])=="none"){return true}}return false}function e(aK){var aJ;return aK.nodeType==3&&(aJ=aK.parentNode)&&ac(aJ,"visibility")=="hidden"}function ay(aJ){return aJ&&((aJ.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(H(aJ)))||aJ.nodeType==9||aJ.nodeType==11)}function w(aK){var aJ=aK.lastChild;return aJ?w(aJ):aK}function x(aJ){return A.isCharacterDataNode(aJ)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(aJ.nodeName)}function Y(aK){var aJ=[];while(aK.parentNode){aJ.unshift(aK.parentNode);aK=aK.parentNode}return aJ}function g(aJ){return Y(aJ).concat([aJ])}function aI(aJ){while(aJ&&!aJ.nextSibling){aJ=aJ.parentNode}if(!aJ){return null}return aJ.nextSibling}function aG(aJ,aK){if(!aK&&aJ.hasChildNodes()){return aJ.firstChild}return aI(aJ)}function f(aL){var aK=aL.previousSibling;if(aK){aL=aK;while(aL.hasChildNodes()){aL=aL.lastChild}return aL}var aJ=aL.parentNode;if(aJ&&aJ.nodeType==1){return aJ}return null}function B(aL){if(!aL||aL.nodeType!=3){return false}var aM=aL.data;if(aM===""){return true}var aK=aL.parentNode;if(!aK||aK.nodeType!=1){return false}var aJ=ac(aL.parentNode,"whiteSpace");return(/^[\t\n\r ]+$/.test(aM)&&/^(normal|nowrap)$/.test(aJ))||(/^[\t\r ]+$/.test(aM)&&aJ=="pre-line")}function aE(aK){if(aK.data===""){return true}if(!B(aK)){return false}var aJ=aK.parentNode;if(!aJ){return true}if(U(aK)){return true}return false}function m(aK){var aJ=aK.nodeType;return aJ==7||aJ==8||U(aK)||/^(script|style)$/i.test(aK.nodeName)||e(aK)||aE(aK)}function aw(aK,aL){var aJ=aK.nodeType;return aJ==7||aJ==8||(aJ==1&&H(aK,aL)=="none")}function M(){this.store={}}M.prototype={get:function(aJ){return this.store.hasOwnProperty(aJ)?this.store[aJ]:null},set:function(aJ,aK){return this.store[aJ]=aK}};var b=0,ah=0;function au(aK,aL,aJ){return function(aN){var aM=this.cache;if(aM.hasOwnProperty(aK)){b++;return aM[aK]}else{ah++;var aO=aL.call(this,aJ?this[aJ]:this,aN);aM[aK]=aO;return aO}}}function aC(aJ,aK){this.node=aJ;this.session=aK;this.cache=new M();this.positions=new M()}var z={getPosition:function(aK){var aJ=this.positions;return aJ.get(aK)||aJ.set(aK,new am(this,aK))},toString:function(){return"[NodeWrapper("+A.inspectNode(this.node)+")]"}};aC.prototype=z;var N="EMPTY",R="NON_SPACE",k="UNCOLLAPSIBLE_SPACE",y="COLLAPSIBLE_SPACE",O="TRAILING_SPACE_BEFORE_BLOCK",G="TRAILING_SPACE_IN_BLOCK",ag="TRAILING_SPACE_BEFORE_BR",h="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",K="TRAILING_LINE_BREAK_AFTER_BR";ab(z,{isCharacterDataNode:au("isCharacterDataNode",A.isCharacterDataNode,"node"),getNodeIndex:au("nodeIndex",A.getNodeIndex,"node"),getLength:au("nodeLength",A.getNodeLength,"node"),containsPositions:au("containsPositions",x,"node"),isWhitespace:au("isWhitespace",B,"node"),isCollapsedWhitespace:au("isCollapsedWhitespace",aE,"node"),getComputedDisplay:au("computedDisplay",H,"node"),isCollapsed:au("collapsed",m,"node"),isIgnored:au("ignored",aw,"node"),next:au("nextPos",aG,"node"),previous:au("previous",f,"node"),getTextNodeInfo:au("textNodeInfo",function(aN){var aM=null,aJ=false;var aK=ac(aN.parentNode,"whiteSpace");var aL=(aK=="pre-line");if(aL){aM=ap;aJ=true}else{if(aK=="normal"||aK=="nowrap"){aM=n;aJ=true}}return{node:aN,text:aN.data,spaceRegex:aM,collapseSpaces:aJ,preLine:aL}},"node"),hasInnerText:au("hasInnerText",function(aL,aN){var aM=this.session;var aP=aM.getPosition(aL.parentNode,this.getNodeIndex()+1);var aK=aM.getPosition(aL,0);var aO=aN?aP:aK;var aJ=aN?aK:aP;while(aO!==aJ){aO.prepopulateChar();if(aO.isDefinitelyNonEmpty()){return true}aO=aN?aO.previousVisible():aO.nextVisible()}return false},"node"),isRenderedBlock:au("isRenderedBlock",function(aL){var aM=aL.getElementsByTagName("br");for(var aK=0,aJ=aM.length;aK<aJ;++aK){if(!m(aM[aK])){return true}}return this.hasInnerText()},"node"),getTrailingSpace:au("trailingSpace",function(aJ){if(aJ.tagName.toLowerCase()=="br"){return""}else{switch(this.getComputedDisplay()){case"inline":var aK=aJ.lastChild;while(aK){if(!aw(aK)){return(aK.nodeType==1)?this.session.getNodeWrapper(aK).getTrailingSpace():""}aK=aK.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(true)?"\n":""}}return""},"node"),getLeadingSpace:au("leadingSpace",function(aJ){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(false)?"\n":""}return""},"node")});function am(aJ,aK){this.offset=aK;this.nodeWrapper=aJ;this.node=aJ.node;this.session=aJ.session;this.cache=new M()}function aq(){return"[Position("+A.inspectNode(this.node)+":"+this.offset+")]"}var W={character:"",characterType:N,isBr:false,prepopulateChar:function(){var aR=this;if(!aR.prepopulatedChar){var aL=aR.node,aN=aR.offset;var aK="",aO=N;var aT=false;if(aN>0){if(aL.nodeType==3){var aU=aL.data;var aJ=aU.charAt(aN-1);var aS=aR.nodeWrapper.getTextNodeInfo();var aP=aS.spaceRegex;if(aS.collapseSpaces){if(aP.test(aJ)){if(aN>1&&aP.test(aU.charAt(aN-2))){}else{if(aS.preLine&&aU.charAt(aN)==="\n"){aK=" ";aO=h}else{aK=" ";aO=y}}}else{aK=aJ;aO=R;aT=true}}else{aK=aJ;aO=k;aT=true}}else{var aQ=aL.childNodes[aN-1];if(aQ&&aQ.nodeType==1&&!m(aQ)){if(aQ.tagName.toLowerCase()=="br"){aK="\n";aR.isBr=true;aO=y;aT=false}else{aR.checkForTrailingSpace=true}}if(!aK){var aM=aL.childNodes[aN];if(aM&&aM.nodeType==1&&!m(aM)){aR.checkForLeadingSpace=true}}}}aR.prepopulatedChar=true;aR.character=aK;aR.characterType=aO;aR.isCharInvariant=aT}},isDefinitelyNonEmpty:function(){var aJ=this.characterType;return aJ==R||aJ==k},resolveLeadingAndTrailingSpaces:function(){if(!this.prepopulatedChar){this.prepopulateChar()}if(this.checkForTrailingSpace){var aK=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();if(aK){this.isTrailingSpace=true;this.character=aK;this.characterType=y}this.checkForTrailingSpace=false}if(this.checkForLeadingSpace){var aJ=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();if(aJ){this.isLeadingSpace=true;this.character=aJ;this.characterType=y}this.checkForLeadingSpace=false}},getPrecedingUncollapsedPosition:function(aJ){var aL=this,aK;while((aL=aL.previousVisible())){aK=aL.getCharacter(aJ);if(aK!==""){return aL}}return null},getCharacter:function(aU){this.resolveLeadingAndTrailingSpaces();var aM=this.character,aW;var aS=S(aU.ignoreCharacters);var aK=(aM!==""&&aS.indexOf(aM)>-1);if(this.isCharInvariant){aW=aK?"":aM;return aW}var aQ=["character",aU.includeSpaceBeforeBr,aU.includeBlockContentTrailingSpace,aU.includePreLineTrailingSpace,aS].join("_");var aL=this.cache.get(aQ);if(aL!==null){return aL}var aN="";var aV=(this.characterType==y);var aP,aO;var aJ=false;var aR=this;function aT(){if(!aJ){aO=aR.getPrecedingUncollapsedPosition(aU);aJ=true}return aO}if(aV){if(aM==" "&&(!aT()||aO.isTrailingSpace||aO.character=="\n")){}else{if(aM=="\n"&&this.isLeadingSpace){if(aT()&&aO.character!="\n"){aN="\n"}else{}}else{aP=this.nextUncollapsed();if(aP){if(aP.isBr){this.type=ag}else{if(aP.isTrailingSpace&&aP.character=="\n"){this.type=G}else{if(aP.isLeadingSpace&&aP.character=="\n"){this.type=O}}}if(aP.character=="\n"){if(this.type==ag&&!aU.includeSpaceBeforeBr){}else{if(this.type==O&&!aU.includeSpaceBeforeBlock){}else{if(this.type==G&&aP.isTrailingSpace&&!aU.includeBlockContentTrailingSpace){}else{if(this.type==h&&aP.type==R&&!aU.includePreLineTrailingSpace){}else{if(aM=="\n"){if(aP.isTrailingSpace){if(this.isTrailingSpace){}else{if(this.isBr){aP.type=K;if(aT()&&aO.isLeadingSpace&&aO.character=="\n"){aP.character=""}else{}}}}else{aN="\n"}}else{if(aM==" "){aN=" "}else{}}}}}}}else{aN=aM}}else{}}}}else{if(aM=="\n"&&(!(aP=this.nextUncollapsed())||aP.isTrailingSpace)){}}if(aS.indexOf(aN)>-1){aN=""}this.cache.set(aQ,aN);return aN},equals:function(aJ){return !!aJ&&this.node===aJ.node&&this.offset===aJ.offset},inspect:aq,toString:function(){return this.character}};am.prototype=W;ab(W,{next:au("nextPos",function(aQ){var aM=aQ.nodeWrapper,aL=aQ.node,aO=aQ.offset,aN=aM.session;if(!aL){return null}var aJ,aK,aP;if(aO==aM.getLength()){aJ=aL.parentNode;aK=aJ?aM.getNodeIndex()+1:0}else{if(aM.isCharacterDataNode()){aJ=aL;aK=aO+1}else{aP=aL.childNodes[aO];if(aN.getNodeWrapper(aP).containsPositions()){aJ=aP;aK=0}else{aJ=aL;aK=aO+1}}}return aJ?aN.getPosition(aJ,aK):null}),previous:au("previous",function(aQ){var aM=aQ.nodeWrapper,aL=aQ.node,aO=aQ.offset,aN=aM.session;var aJ,aK,aP;if(aO==0){aJ=aL.parentNode;aK=aJ?aM.getNodeIndex():0}else{if(aM.isCharacterDataNode()){aJ=aL;aK=aO-1}else{aP=aL.childNodes[aO-1];if(aN.getNodeWrapper(aP).containsPositions()){aJ=aP;aK=A.getNodeLength(aP)}else{aJ=aL;aK=aO-1}}}return aJ?aN.getPosition(aJ,aK):null}),nextVisible:au("nextVisible",function(aN){var aK=aN.next();if(!aK){return null}var aM=aK.nodeWrapper,aL=aK.node;var aJ=aK;if(aM.isCollapsed()){aJ=aM.session.getPosition(aL.parentNode,aM.getNodeIndex()+1)}return aJ}),nextUncollapsed:au("nextUncollapsed",function(aK){var aJ=aK;while((aJ=aJ.nextVisible())){aJ.resolveLeadingAndTrailingSpaces();if(aJ.character!==""){return aJ}}return null}),previousVisible:au("previousVisible",function(aN){var aL=aN.previous();if(!aL){return null}var aM=aL.nodeWrapper,aK=aL.node;var aJ=aL;if(aM.isCollapsed()){aJ=aM.session.getPosition(aK.parentNode,aM.getNodeIndex())}return aJ})});var aa=null;var P=(function(){function aJ(aN){var aM=new M();return{get:function(aQ){var aP=aM.get(aQ[aN]);if(aP){for(var aO=0,aR;aR=aP[aO++];){if(aR.node===aQ){return aR}}}return null},set:function(aQ){var aP=aQ.node[aN];var aO=aM.get(aP)||aM.set(aP,[]);aO.push(aQ)}}}var aK=an.isHostProperty(document.documentElement,"uniqueID");function aL(){this.initCaches()}aL.prototype={initCaches:function(){this.elementCache=aK?(function(){var aM=new M();return{get:function(aN){return aM.get(aN.uniqueID)},set:function(aN){aM.set(aN.node.uniqueID,aN)}}})():aJ("tagName");this.textNodeCache=aJ("data");this.otherNodeCache=aJ("nodeName")},getNodeWrapper:function(aM){var aO;switch(aM.nodeType){case 1:aO=this.elementCache;break;case 3:aO=this.textNodeCache;break;default:aO=this.otherNodeCache;break}var aN=aO.get(aM);if(!aN){aN=new aC(aM,this);aO.set(aN)}return aN},getPosition:function(aM,aN){return this.getNodeWrapper(aM).getPosition(aN)},getRangeBoundaryPosition:function(aN,aM){var aO=aM?"start":"end";return this.getPosition(aN[aO+"Container"],aN[aO+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}};return aL})();function Z(){aF();return(aa=new P())}function F(){return aa||Z()}function aF(){if(aa){aa.detach()}aa=null}ab(A,{nextNode:aG,previousNode:f});function t(aN,aR,aJ,aQ){if(aJ){if(aR){if(m(aJ.node)){aJ=aN.previousVisible()}}else{if(m(aJ.node)){aJ=aJ.nextVisible()}}}var aO=aN,aL=false;function aM(){var aS=null;if(aR){aS=aO;if(!aL){aO=aO.previousVisible();aL=!aO||(aJ&&aO.equals(aJ))}}else{if(!aL){aS=aO=aO.nextVisible();aL=!aO||(aJ&&aO.equals(aJ))}}if(aL){aO=null}return aS}var aK,aP=false;return{next:function(){if(aP){aP=false;return aK}else{var aT,aS;while((aT=aM())){aS=aT.getCharacter(aQ);if(aS){aK=aT;return aT}}return null}},rewind:function(){if(aK){aP=true}else{throw aD.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.")}},dispose:function(){aN=aJ=null}}}var q=Array.prototype.indexOf?function(aJ,aK){return aJ.indexOf(aK)}:function(aK,aM){for(var aL=0,aJ=aK.length;aL<aJ;++aL){if(aK[aL]===aM){return aL}}return -1};function c(aR,aU,aP){var aL=t(aR,false,null,aU);var aO=t(aR,true,null,aU);var aT=aP.tokenizer;function aM(aW){var a2,a1;var a0=[],aX=aW?aL:aO;var aZ=false,aY=false;while((a2=aX.next())){a1=a2.character;if(ai.test(a1)){if(aY){aY=false;aZ=true}}else{if(aZ){aX.rewind();break}else{aY=true}}a0.push(a2)}return a0}var aK=aM(true);var aN=aM(false).reverse();var aQ=aT(aN.concat(aK),aP);var aS=aK.length?aQ.slice(q(aQ,aK[0].token)):[];var aJ=aN.length?aQ.slice(0,q(aQ,aN.pop().token)+1):[];function aV(aW){var aY=["["+aW.length+"]"];for(var aX=0;aX<aW.length;++aX){aY.push("(word: "+aW[aX]+", is word: "+aW[aX].isWord+")")}return aY}return{nextEndToken:function(){var aW,aX;while(aS.length==1&&!(aW=aS[0]).isWord&&(aX=aM(true)).length>0){aS=aT(aW.chars.concat(aX),aP)}return aS.shift()},previousStartToken:function(){var aW,aX;while(aJ.length==1&&!(aW=aJ[0]).isWord&&(aX=aM(false)).length>0){aJ=aT(aX.reverse().concat(aW.chars),aP)}return aJ.pop()},dispose:function(){aL.dispose();aO.dispose();aS=aJ=null}}}function J(aT,aV,aP,aW,aL){var aO=0,aQ,aS=aT,aU,aR,aK=Math.abs(aP),aJ;if(aP!==0){var aX=(aP<0);switch(aV){case L:aU=t(aT,aX,null,aW);while((aQ=aU.next())&&aO<aK){++aO;aS=aQ}aR=aQ;aU.dispose();break;case j:var aM=c(aT,aW,aL);var aN=aX?aM.previousStartToken:aM.nextEndToken;while((aJ=aN())&&aO<aK){if(aJ.isWord){++aO;aS=aX?aJ.chars[0]:aJ.chars[aJ.chars.length-1]}}break;default:throw new Error("movePositionBy: unit '"+aV+"' not implemented")}if(aX){aS=aS.previousVisible();aO=-aO}else{if(aS&&aS.isLeadingSpace){if(aV==j){aU=t(aT,false,null,aW);aR=aU.next();aU.dispose()}if(aR){aS=aR.previousVisible()}}}}return{position:aS,unitsMoved:aO}}function ae(aP,aL,aK,aQ){var aO=aP.getRangeBoundaryPosition(aL,true);var aN=aP.getRangeBoundaryPosition(aL,false);var aJ=aQ?aN:aO;var aM=aQ?aO:aN;return t(aJ,!!aQ,aM,aK)}function ad(aN,aK,aJ){var aM=[],aL=ae(aN,aK,aJ),aO;while((aO=aL.next())){aM.push(aO)}aL.dispose();return aM}function C(aL,aK,aM){var aJ=v.createRange(aL.node);aJ.setStartAndEnd(aL.node,aL.offset,aK.node,aK.offset);return !aJ.expand("word",{wordOptions:aM})}function ak(aM,aN,aT,aR,aP){var aZ=ax(aP.direction);var aO=t(aM,aZ,aM.session.getRangeBoundaryPosition(aR,aZ),aP.characterOptions);var aW="",aS=[],aU,aX,aL,aV;var aY,aQ;var aK=null;function aJ(a4,a3){var a1=aS[a4].previousVisible();var a0=aS[a3-1];var a2=(!aP.wholeWordsOnly||C(a1,a0,aP.wordOptions));return{startPos:a1,endPos:a0,valid:a2}}while((aU=aO.next())){aX=aU.character;if(!aT&&!aP.caseSensitive){aX=aX.toLowerCase()}if(aZ){aS.unshift(aU);aW=aX+aW}else{aS.push(aU);aW+=aX}if(aT){aY=aN.exec(aW);if(aY){aL=aY.index;aV=aL+aY[0].length;if(aQ){if((!aZ&&aV<aW.length)||(aZ&&aL>0)){aK=aJ(aL,aV);break}}else{aQ=true}}}else{if((aL=aW.indexOf(aN))!=-1){aK=aJ(aL,aL+aN.length);break}}}if(aQ){aK=aJ(aL,aV)}aO.dispose();return aK}function X(aJ){return function(){var aN=!!aa;var aM=F();var aK=[aM].concat(an.toArray(arguments));var aL=aJ.apply(this,aK);if(!aN){aF()}return aL}}function az(aJ,aK){return X(function(aR,aQ,aP,aO){if(typeof aP==D){aP=aQ;aQ=L}aO=aj(aO,af);var aM=aJ;if(aK){aM=(aP>=0);this.collapse(!aM)}var aL=J(aR.getRangeBoundaryPosition(this,aM),aQ,aP,aO.characterOptions,aO.wordOptions);var aN=aL.position;this[aM?"setStart":"setEnd"](aN.node,aN.offset);return aL.unitsMoved})}function o(aJ){return X(function(aO,aK){aK=s(aK,aA);var aP;var aL=ae(aO,this,aK,!aJ);var aM=0;while((aP=aL.next())&&ai.test(aP.character)){++aM}aL.dispose();var aN=(aM>0);if(aN){this[aJ?"moveStart":"moveEnd"]("character",aJ?aM:-aM,{characterOptions:aK})}return aN})}ab(v.rangePrototype,{moveStart:az(true,false),moveEnd:az(false,false),move:az(true,true),trimStart:o(true),trimEnd:o(false),trim:X(function(aL,aJ){var aM=this.trimStart(aJ),aK=this.trimEnd(aJ);return aM||aK}),expand:X(function(aS,aV,aT){var aU=false;aT=aj(aT,ar);var aW=aT.characterOptions;if(!aV){aV=L}if(aV==j){var aM=aT.wordOptions;var aQ=aS.getRangeBoundaryPosition(this,true);var aJ=aS.getRangeBoundaryPosition(this,false);var aN=c(aQ,aW,aM);var aP=aN.nextEndToken();var aR=aP.chars[0].previousVisible();var aK,aL;if(this.collapsed){aK=aP}else{var aO=c(aJ,aW,aM);aK=aO.previousStartToken()}aL=aK.chars[aK.chars.length-1];if(!aR.equals(aQ)){this.setStart(aR.node,aR.offset);aU=true}if(aL&&!aL.equals(aJ)){this.setEnd(aL.node,aL.offset);aU=true}if(aT.trim){if(aT.trimStart){aU=this.trimStart(aW)||aU}if(aT.trimEnd){aU=this.trimEnd(aW)||aU}}return aU}else{return this.moveEnd(L,1,aT)}}),text:X(function(aK,aJ){return this.collapsed?"":ad(aK,this,s(aJ,aA)).join("")}),selectCharacters:X(function(aN,aJ,aO,aM,aK){var aL={characterOptions:aK};if(!aJ){aJ=aB(this.getDocument())}this.selectNodeContents(aJ);this.collapse(true);this.moveStart("character",aO,aL);this.collapse(true);this.moveEnd("character",aM-aO,aL)}),toCharacterRange:X(function(aM,aK,aR){if(!aK){aK=aB(this.getDocument())}var aO=aK.parentNode,aJ=A.getNodeIndex(aK);var aQ=(A.comparePoints(this.startContainer,this.endContainer,aO,aJ)==-1);var aN=this.cloneRange();var aP,aL;if(aQ){aN.setStartAndEnd(this.startContainer,this.startOffset,aO,aJ);aP=-aN.text(aR).length}else{aN.setStartAndEnd(aO,aJ,this.startContainer,this.startOffset);aP=aN.text(aR).length}aL=aP+this.text(aR).length;return{start:aP,end:aL}}),findText:X(function(aP,aL,aN){aN=aj(aN,T);if(aN.wholeWordsOnly){aN.wordOptions.includeTrailingSpace=false}var aU=ax(aN.direction);var aO=aN.withinRange;if(!aO){aO=v.createRange();aO.selectNodeContents(this.getDocument())}var aM=aL,aQ=false;if(typeof aM=="string"){if(!aN.caseSensitive){aM=aM.toLowerCase()}}else{aQ=true}var aK=aP.getRangeBoundaryPosition(this,!aU);var aT=aO.comparePoint(aK.node,aK.offset);if(aT===-1){aK=aP.getRangeBoundaryPosition(aO,true)}else{if(aT===1){aK=aP.getRangeBoundaryPosition(aO,false)}}var aS=aK;var aR=false;var aJ;while(true){aJ=ak(aS,aM,aQ,aO,aN);if(aJ){if(aJ.valid){this.setStartAndEnd(aJ.startPos.node,aJ.startPos.offset,aJ.endPos.node,aJ.endPos.offset);return true}else{aS=aU?aJ.startPos:aJ.endPos}}else{if(aN.wrap&&!aR){aO=aO.cloneRange();aS=aP.getRangeBoundaryPosition(aO,!aU);aO.setBoundary(aK.node,aK.offset,aU);aR=true}else{return false}}}}),pasteHtml:function(aJ){this.deleteContents();if(aJ){var aL=this.createContextualFragment(aJ);var aK=aL.lastChild;this.insertNode(aL);this.collapseAfter(aK)}}});function i(aJ){return X(function(aM,aK){var aL=false;this.changeEachRange(function(aN){aL=aN[aJ](aK)||aL});return aL})}ab(v.selectionPrototype,{expand:X(function(aL,aK,aJ){this.changeEachRange(function(aM){aM.expand(aK,aJ)})}),move:X(function(aN,aM,aL,aK){var aO=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var aJ=this.getRangeAt(0);if(!aK){aK={}}aK.characterOptions=s(aK.characterOptions,aH);aO=aJ.move(aM,aL,aK);this.setSingleRange(aJ)}return aO}),trimStart:i("trimStart"),trimEnd:i("trimEnd"),trim:i("trim"),selectCharacters:X(function(aO,aJ,aP,aM,aN,aK){var aL=v.createRange(aJ);aL.selectCharacters(aJ,aP,aM,aK);this.setSingleRange(aL,aN)}),saveCharacterRanges:X(function(aP,aK,aQ){var aJ=this.getAllRanges(),aL=aJ.length;var aN=[];var aR=aL==1&&this.isBackward();for(var aM=0,aO=aJ.length;aM<aO;++aM){aN[aM]={characterRange:aJ[aM].toCharacterRange(aK,aQ),backward:aR,characterOptions:aQ}}return aN}),restoreCharacterRanges:X(function(aP,aK,aO){this.removeAllRanges();for(var aN=0,aJ=aO.length,aM,aL,aQ;aN<aJ;++aN){aL=aO[aN];aQ=aL.characterRange;aM=v.createRange(aK);aM.selectCharacters(aK,aQ.start,aQ.end,aL.characterOptions);this.addRange(aM,aL.backward)}}),text:X(function(aN,aK){var aM=[];for(var aL=0,aJ=this.rangeCount;aL<aJ;++aL){aM[aL]=this.getRangeAt(aL).text(aK)}return aM.join("")})});v.innerText=function(aL,aJ){var aK=v.createRange(aL);aK.selectNodeContents(aL);var aM=aK.text(aJ);return aM};v.createWordIterator=function(aM,aJ,aL){var aO=F();aL=aj(aL,I);var aK=aO.getPosition(aM,aJ);var aN=c(aK,aL.characterOptions,aL.wordOptions);var aP=ax(aL.direction);return{next:function(){return aP?aN.previousStartToken():aN.nextEndToken()},dispose:function(){aN.dispose();this.next=function(){}}}};v.noMutation=function(aJ){var aK=F();aJ(aK);aF()};v.noMutation.createEntryPointFunction=X;v.textRange={isBlockNode:ay,isCollapsedWhitespaceNode:aE,createPosition:X(function(aK,aJ,aL){return aK.getPosition(aJ,aL)})}});return a},this);
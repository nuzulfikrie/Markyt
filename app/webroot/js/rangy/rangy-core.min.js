(function(b,a){if(typeof define=="function"&&define.amd){define(b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b()}else{a.rangy=b()}}})(function(){var u="object",d="function",A="undefined";var a=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var q=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var H=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function D(O,N){var M=typeof O[N];return M==d||(!!(M==u&&O[N]))||M=="unknown"}function y(N,M){return !!(typeof N[M]==u&&N[M])}function f(N,M){return typeof N[M]!=A}function w(M){return function(P,O){var N=O.length;while(N--){if(!M(P,O[N])){return false}}return true}}var j=w(D);var t=w(y);var g=w(f);function z(M){return M&&j(M,H)&&g(M,l)}function K(M){return y(M,"body")?M.body:M.getElementsByTagName("body")[0]}var b=[].forEach?function(M,N){M.forEach(N)}:function(N,P){for(var O=0,M=N.length;O<M;++O){P(N[O],O)}};var v={};var C=(typeof window!=A&&typeof document!=A);var k={isHostMethod:D,isHostObject:y,isHostProperty:f,areHostMethods:j,areHostObjects:t,areHostProperties:g,isTextRange:z,getBody:K,forEach:b};var h={version:"1.3.0-beta.2",initialized:false,isBrowser:C,supported:true,util:k,features:{},modules:v,config:{alertOnFail:false,alertOnWarn:false,preferTextRange:false,autoInitialize:(typeof rangyAutoInitialize==A)?true:rangyAutoInitialize}};function G(M){if(typeof console!=A&&D(console,"log")){console.log(M)}}function p(N,M){if(C&&M){alert(N)}else{G(N)}}function m(M){h.initialized=true;h.supported=false;p("Rangy is not supported in this environment. Reason: "+M,h.config.alertOnFail)}h.fail=m;function n(M){p("Rangy warning: "+M,h.config.alertOnWarn)}h.warn=n;var o;if({}.hasOwnProperty){k.extend=o=function(Q,O,M){var R,P;for(var N in O){if(O.hasOwnProperty(N)){R=Q[N];P=O[N];if(M&&R!==null&&typeof R=="object"&&P!==null&&typeof P=="object"){o(R,P,true)}Q[N]=P}}if(O.hasOwnProperty("toString")){Q.toString=O.toString}return Q};k.createOptions=function(M,O){var N={};o(N,O);if(M){o(N,M)}return N}}else{m("hasOwnProperty not supported")}if(!C){m("Rangy can only run in a browser")}(function(){var M;if(C){var N=document.createElement("div");N.appendChild(document.createElement("span"));var P=[].slice;try{if(P.call(N.childNodes,0)[0].nodeType==1){M=function(Q){return P.call(Q,0)}}}catch(O){}}if(!M){M=function(S){var R=[];for(var T=0,Q=S.length;T<Q;++T){R[T]=S[T]}return R}}k.toArray=M})();var i;if(C){if(D(document,"addEventListener")){i=function(O,M,N){O.addEventListener(M,N,false)}}else{if(D(document,"attachEvent")){i=function(O,M,N){O.attachEvent("on"+M,N)}}else{m("Document does not have required addEventListener or attachEvent method")}}k.addListener=i}var L=[];function c(M){return M.message||M.description||String(M)}function I(){if(!C||h.initialized){return}var O;var V=false,P=false;if(D(document,"createRange")){O=document.createRange();if(j(O,q)&&g(O,a)){V=true}}var R=K(document);if(!R||R.nodeName.toLowerCase()!="body"){m("No body element found");return}if(R&&D(R,"createTextRange")){O=R.createTextRange();if(z(O)){P=true}}if(!V&&!P){m("Neither Range nor TextRange are available");return}h.initialized=true;h.features={implementsDomRange:V,implementsTextRange:P};var N,T;for(var M in v){if((N=v[M]) instanceof x){N.init(N,h)}}for(var Q=0,S=L.length;Q<S;++Q){try{L[Q](h)}catch(U){T="Rangy init listener threw an exception. Continuing. Detail: "+c(U);G(T)}}}h.init=I;h.addInitListener=function(M){if(h.initialized){M(h)}else{L.push(M)}};var s=[];h.addShimListener=function(M){s.push(M)};function E(O){O=O||window;I();for(var N=0,M=s.length;N<M;++N){s[N](O)}}if(C){h.shim=h.createMissingNativeApi=E}function x(M,O,N){this.name=M;this.dependencies=O;this.initialized=false;this.supported=false;this.initializer=N}x.prototype={init:function(){var P=this.dependencies||[];for(var O=0,M=P.length,Q,N;O<M;++O){N=P[O];Q=v[N];if(!Q||!(Q instanceof x)){throw new Error("required module '"+N+"' not found")}Q.init();if(!Q.supported){throw new Error("required module '"+N+"' not supported")}}this.initializer(this)},fail:function(M){this.initialized=true;this.supported=false;throw new Error(M)},warn:function(M){h.warn("Module "+this.name+": "+M)},deprecationNotice:function(M,N){h.warn("DEPRECATED: "+M+" in module "+this.name+"is deprecated. Please use "+N+" instead")},createError:function(M){return new Error("Error in Rangy "+this.name+" module: "+M)}};function r(M,O,P){var N=new x(M,O,function(S){if(!S.initialized){S.initialized=true;try{P(h,S);S.supported=true}catch(R){var Q="Module '"+M+"' failed to load: "+c(R);G(Q);if(R.stack){G(R.stack)}}}});v[M]=N;return N}h.createModule=function(M){var P,O;if(arguments.length==2){P=arguments[1];O=[]}else{P=arguments[2];O=arguments[1]}var N=r(M,O,P);if(h.initialized&&h.supported){N.init()}};h.createCoreModule=function(M,N,O){r(M,N,O)};function F(){}h.RangePrototype=F;h.rangePrototype=new F();function B(){}h.selectionPrototype=new B();h.createCoreModule("DomUtil",[],function(P,N){var af="undefined";var R=P.util;var av=R.getBody;if(!R.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){N.fail("document missing a Node creation method")}if(!R.isHostMethod(document,"getElementsByTagName")){N.fail("document missing getElementsByTagName method")}var at=document.createElement("div");if(!R.areHostMethods(at,["insertBefore","appendChild","cloneNode"]||!R.areHostObjects(at,["previousSibling","nextSibling","childNodes","parentNode"]))){N.fail("Incomplete Element implementation")}if(!R.isHostProperty(at,"innerHTML")){N.fail("Element is missing innerHTML property")}var aw=document.createTextNode("test");if(!R.areHostMethods(aw,["splitText","deleteData","insertData","appendData","cloneNode"]||!R.areHostObjects(at,["previousSibling","nextSibling","childNodes","parentNode"])||!R.areHostProperties(aw,["data"]))){N.fail("Incomplete Text Node implementation")}var az=function(aA,aC){var aB=aA.length;while(aB--){if(aA[aB]===aC){return true}}return false};function T(aB){var aA;return typeof aB.namespaceURI==af||((aA=aB.namespaceURI)===null||aA=="http://www.w3.org/1999/xhtml")}function ag(aB){var aA=aB.parentNode;return(aA.nodeType==1)?aA:null}function aa(aB){var aA=0;while((aB=aB.previousSibling)){++aA}return aA}function ai(aA){switch(aA.nodeType){case 7:case 10:return 0;case 3:case 8:return aA.length;default:return aA.childNodes.length}}function X(aB,aA){var aC=[],aD;for(aD=aB;aD;aD=aD.parentNode){aC.push(aD)}for(aD=aA;aD;aD=aD.parentNode){if(az(aC,aD)){return aD}}return null}function W(aA,aB,aD){var aC=aD?aB:aB.parentNode;while(aC){if(aC===aA){return true}else{aC=aC.parentNode}}return false}function aq(aA,aB){return W(aA,aB,true)}function an(aB,aA,aE){var aC,aD=aE?aB:aB.parentNode;while(aD){aC=aD.parentNode;if(aC===aA){return aD}aD=aC}return null}function O(aB){var aA=aB.nodeType;return aA==3||aA==4||aA==8}function M(aB){if(!aB){return false}var aA=aB.nodeType;return aA==3||aA==8}function S(aD,aB){var aA=aB.nextSibling,aC=aB.parentNode;if(aA){aC.insertBefore(aD,aA)}else{aC.appendChild(aD)}return aD}function ah(aF,aC,aB){var aE=aF.cloneNode(false);aE.deleteData(0,aC);aF.deleteData(aC,aF.length-aC);S(aE,aF);if(aB){for(var aD=0,aA;aA=aB[aD++];){if(aA.node==aF&&aA.offset>aC){aA.node=aE;aA.offset-=aC}else{if(aA.node==aF.parentNode&&aA.offset>aa(aF)){++aA.offset}}}}return aE}function ax(aA){if(aA.nodeType==9){return aA}else{if(typeof aA.ownerDocument!=af){return aA.ownerDocument}else{if(typeof aA.document!=af){return aA.document}else{if(aA.parentNode){return ax(aA.parentNode)}else{throw N.createError("getDocument: no document found for node")}}}}}function Z(aA){var aB=ax(aA);if(typeof aB.defaultView!=af){return aB.defaultView}else{if(typeof aB.parentWindow!=af){return aB.parentWindow}else{throw N.createError("Cannot get a window object for node")}}}function ay(aA){if(typeof aA.contentDocument!=af){return aA.contentDocument}else{if(typeof aA.contentWindow!=af){return aA.contentWindow.document}else{throw N.createError("getIframeDocument: No Document object found for iframe element")}}}function au(aA){if(typeof aA.contentWindow!=af){return aA.contentWindow}else{if(typeof aA.contentDocument!=af){return aA.contentDocument.defaultView}else{throw N.createError("getIframeWindow: No Window object found for iframe element")}}}function al(aA){return aA&&R.isHostMethod(aA,"setTimeout")&&R.isHostObject(aA,"document")}function ak(aD,aB,aA){var aC;if(!aD){aC=document}else{if(R.isHostProperty(aD,"nodeType")){aC=(aD.nodeType==1&&aD.tagName.toLowerCase()=="iframe")?ay(aD):ax(aD)}else{if(al(aD)){aC=aD.document}}}if(!aC){throw aB.createError(aA+"(): Parameter must be a Window object or DOM node")}return aC}function U(aB){var aA;while((aA=aB.parentNode)){aB=aA}return aB}function ao(aD,aF,aC,aE){var aA,aG,aI,aH,aB;if(aD==aC){return aF===aE?0:(aF<aE)?-1:1}else{if((aA=an(aC,aD,true))){return aF<=aa(aA)?-1:1}else{if((aA=an(aD,aC,true))){return aa(aA)<aE?-1:1}else{aG=X(aD,aC);if(!aG){throw new Error("comparePoints error: nodes have no common ancestor")}aI=(aD===aG)?aG:an(aD,aG,true);aH=(aC===aG)?aG:an(aC,aG,true);if(aI===aH){throw N.createError("comparePoints got to case 4 and childA and childB are the same!")}else{aB=aG.firstChild;while(aB){if(aB===aI){return -1}else{if(aB===aH){return 1}}aB=aB.nextSibling}}}}}}var ad=false;function ac(aA){var aC;try{aC=aA.parentNode;return false}catch(aB){return true}}(function(){var aA=document.createElement("b");aA.innerHTML="1";var aB=aA.firstChild;aA.innerHTML="<br />";ad=ac(aB);P.features.crashyTextNodes=ad})();function ae(aA){if(!aA){return"[No node]"}if(ad&&ac(aA)){return"[Broken node]"}if(O(aA)){return'"'+aA.data+'"'}if(aA.nodeType==1){var aB=aA.id?' id="'+aA.id+'"':"";return"<"+aA.nodeName+aB+">[index:"+aa(aA)+",length:"+aA.childNodes.length+"]["+(aA.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return aA.nodeName}function am(aB){var aA=ax(aB).createDocumentFragment(),aC;while((aC=aB.firstChild)){aA.appendChild(aC)}return aA}var Y;if(typeof window.getComputedStyle!=af){Y=function(aA,aB){return Z(aA).getComputedStyle(aA,null)[aB]}}else{if(typeof document.documentElement.currentStyle!=af){Y=function(aA,aB){return aA.currentStyle[aB]}}else{N.fail("No means of obtaining computed style properties found")}}function ap(aF,aC,aE){var aA=av(aF);var aD=aF.createElement("div");aD.contentEditable=""+!!aE;if(aC){aD.innerHTML=aC}var aB=aA.firstChild;if(aB){aA.insertBefore(aD,aB)}else{aA.appendChild(aD)}return aD}function V(aA){return aA.parentNode.removeChild(aA)}function Q(aA){this.root=aA;this._next=aA}Q.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var aC=this._current=this._next;var aB,aA;if(this._current){aB=aC.firstChild;if(aB){this._next=aB}else{aA=null;while((aC!==this.root)&&!(aA=aC.nextSibling)){aC=aC.parentNode}this._next=aA}}return this._current},detach:function(){this._current=this._next=this.root=null}};function ar(aA){return new Q(aA)}function ab(aA,aB){this.node=aA;this.offset=aB}ab.prototype={equals:function(aA){return !!aA&&this.node===aA.node&&this.offset==aA.offset},inspect:function(){return"[DomPosition("+ae(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function aj(aA){this.code=this[aA];this.codeName=aA;this.message="DOMException: "+this.codeName}aj.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};aj.prototype.toString=function(){return this.message};P.dom={arrayContains:az,isHtmlNamespace:T,parentElement:ag,getNodeIndex:aa,getNodeLength:ai,getCommonAncestor:X,isAncestorOf:W,isOrIsAncestorOf:aq,getClosestAncestorIn:an,isCharacterDataNode:O,isTextOrCommentNode:M,insertAfter:S,splitDataNode:ah,getDocument:ax,getWindow:Z,getIframeWindow:au,getIframeDocument:ay,getBody:av,isWindow:al,getContentDocument:ak,getRootContainer:U,comparePoints:ao,isBrokenNode:ac,inspectNode:ae,getComputedStyleProperty:Y,createTestElement:ap,removeNode:V,fragmentFromNodeChildren:am,createIterator:ar,DomPosition:ab};P.DOMException=aj});h.createCoreModule("DomRange",["DomUtil"],function(aa,a5){var ad=aa.dom;var aT=aa.util;var ar=ad.DomPosition;var aJ=aa.DOMException;var aw=ad.isCharacterDataNode;var O=ad.getNodeIndex;var av=ad.isOrIsAncestorOf;var a6=ad.getDocument;var aV=ad.comparePoints;var a1=ad.splitDataNode;var aM=ad.getClosestAncestorIn;var az=ad.getNodeLength;var a3=ad.arrayContains;var ae=ad.getRootContainer;var ah=aa.features.crashyTextNodes;var aY=ad.removeNode;function aP(a8,a7){return(a8.nodeType!=3)&&(av(a8,a7.startContainer)||av(a8,a7.endContainer))}function aW(a7){return a7.document||a6(a7.startContainer)}function ai(a7){return new ar(a7.parentNode,O(a7))}function T(a7){return new ar(a7.parentNode,O(a7)+1)}function P(a8,ba,a9){var a7=a8.nodeType==11?a8.firstChild:a8;if(aw(ba)){if(a9==ba.length){ad.insertAfter(a8,ba)}else{ba.parentNode.insertBefore(a8,a9==0?ba:a1(ba,a9))}}else{if(a9>=ba.childNodes.length){ba.appendChild(a8)}else{ba.insertBefore(a8,ba.childNodes[a9])}}return a7}function U(ba,a9,a7){M(ba);M(a9);if(aW(a9)!=aW(ba)){throw new aJ("WRONG_DOCUMENT_ERR")}var bb=aV(ba.startContainer,ba.startOffset,a9.endContainer,a9.endOffset),a8=aV(ba.endContainer,ba.endOffset,a9.startContainer,a9.startOffset);return a7?bb<=0&&a8>=0:bb<0&&a8>0}function ab(a9){var a8;for(var ba,bb=aW(a9.range).createDocumentFragment(),a7;ba=a9.next();){a8=a9.isPartiallySelectedSubtree();ba=ba.cloneNode(!a8);if(a8){a7=a9.getSubtreeIterator();ba.appendChild(ab(a7));a7.detach()}if(ba.nodeType==10){throw new aJ("HIERARCHY_REQUEST_ERR")}bb.appendChild(ba)}return bb}function aX(a8,bb,a7){var a9,bd;a7=a7||{stop:false};for(var ba,bc;ba=a8.next();){if(a8.isPartiallySelectedSubtree()){if(bb(ba)===false){a7.stop=true;return}else{bc=a8.getSubtreeIterator();aX(bc,bb,a7);bc.detach();if(a7.stop){return}}}else{a9=ad.createIterator(ba);while((bd=a9.next())){if(bb(bd)===false){a7.stop=true;return}}}}}function ax(a8){var a7;while(a8.next()){if(a8.isPartiallySelectedSubtree()){a7=a8.getSubtreeIterator();ax(a7);a7.detach()}else{a8.remove()}}}function aS(a8){for(var a9,ba=aW(a8.range).createDocumentFragment(),a7;a9=a8.next();){if(a8.isPartiallySelectedSubtree()){a9=a9.cloneNode(false);a7=a8.getSubtreeIterator();a9.appendChild(aS(a7));a7.detach()}else{a8.remove()}if(a9.nodeType==10){throw new aJ("HIERARCHY_REQUEST_ERR")}ba.appendChild(a9)}return ba}function aA(a9,a7,ba){var bc=!!(a7&&a7.length),bb;var bd=!!ba;if(bc){bb=new RegExp("^("+a7.join("|")+")$")}var a8=[];aX(new ag(a9,false),function(bf){if(bc&&!bb.test(bf.nodeType)){return}if(bd&&!ba(bf)){return}var bg=a9.startContainer;if(bf==bg&&aw(bg)&&a9.startOffset==bg.length){return}var be=a9.endContainer;if(bf==be&&aw(be)&&a9.endOffset==0){return}a8.push(bf)});return a8}function a0(a7){var a8=(typeof a7.getName=="undefined")?"Range":a7.getName();return"["+a8+"("+ad.inspectNode(a7.startContainer)+":"+a7.startOffset+", "+ad.inspectNode(a7.endContainer)+":"+a7.endOffset+")]"}function ag(a9,a8){this.range=a9;this.clonePartiallySelectedTextNodes=a8;if(!a9.collapsed){this.sc=a9.startContainer;this.so=a9.startOffset;this.ec=a9.endContainer;this.eo=a9.endOffset;var a7=a9.commonAncestorContainer;if(this.sc===this.ec&&aw(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===a7&&!aw(this.sc))?this.sc.childNodes[this.so]:aM(this.sc,a7,true);this._last=(this.ec===a7&&!aw(this.ec))?this.ec.childNodes[this.eo-1]:aM(this.ec,a7,true)}}}ag.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var a7=this._current=this._next;if(a7){this._next=(a7!==this._last)?a7.nextSibling:null;if(aw(a7)&&this.clonePartiallySelectedTextNodes){if(a7===this.ec){(a7=a7.cloneNode(true)).deleteData(this.eo,a7.length-this.eo)}if(this._current===this.sc){(a7=a7.cloneNode(true)).deleteData(0,this.so)}}}return a7},remove:function(){var a8=this._current,a9,a7;if(aw(a8)&&(a8===this.sc||a8===this.ec)){a9=(a8===this.sc)?this.so:0;a7=(a8===this.ec)?this.eo:a8.length;if(a9!=a7){a8.deleteData(a9,a7-a9)}}else{if(a8.parentNode){aY(a8)}else{}}},isPartiallySelectedSubtree:function(){var a7=this._current;return aP(a7,this.range)},getSubtreeIterator:function(){var a8;if(this.isSingleCharacterDataNode){a8=this.range.cloneRange();a8.collapse(false)}else{a8=new am(aW(this.range));var bc=this._current;var ba=bc,a7=0,bb=bc,a9=az(bc);if(av(bc,this.sc)){ba=this.sc;a7=this.so}if(av(bc,this.ec)){bb=this.ec;a9=this.eo}aO(a8,ba,a7,bb,a9)}return new ag(a8,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var aC=[1,3,4,5,7,8,10];var aU=[2,9,11];var V=[5,6,10,12];var ak=[1,3,4,5,7,8,10,11];var a4=[1,3,4,5,7,8];function Y(a7){return function(a9,bb){var a8,ba=bb?a9:a9.parentNode;while(ba){a8=ba.nodeType;if(a3(a7,a8)){return ba}ba=ba.parentNode}return null}}var a2=Y([9,11]);var aq=Y(V);var aj=Y([6,10,12]);function Z(a8,a7){if(aj(a8,a7)){throw new aJ("INVALID_NODE_TYPE_ERR")}}function N(a7,a8){if(!a3(a8,a7.nodeType)){throw new aJ("INVALID_NODE_TYPE_ERR")}}function aD(a7,a8){if(a8<0||a8>(aw(a7)?a7.length:a7.childNodes.length)){throw new aJ("INDEX_SIZE_ERR")}}function aL(a8,a7){if(a2(a8,true)!==a2(a7,true)){throw new aJ("WRONG_DOCUMENT_ERR")}}function ay(a7){if(aq(a7,true)){throw new aJ("NO_MODIFICATION_ALLOWED_ERR")}}function aF(a8,a7){if(!a8){throw new aJ(a7)}}function aN(a7){return(ah&&ad.isBrokenNode(a7))||!a3(aU,a7.nodeType)&&!a2(a7,true)}function S(a7,a8){return a8<=(aw(a7)?a7.length:a7.childNodes.length)}function an(a7){return(!!a7.startContainer&&!!a7.endContainer&&!aN(a7.startContainer)&&!aN(a7.endContainer)&&S(a7.startContainer,a7.startOffset)&&S(a7.endContainer,a7.endOffset))}function M(a7){if(!an(a7)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+a7.inspect()+")")}}var aE=document.createElement("style");var au=false;try{aE.innerHTML="<b>x</b>";au=(aE.firstChild.nodeType==3)}catch(at){}aa.features.htmlParsingConforms=au;var af=au?function(a9){var a8=this.startContainer;var ba=a6(a8);if(!a8){throw new aJ("INVALID_STATE_ERR")}var a7=null;if(a8.nodeType==1){a7=a8}else{if(aw(a8)){a7=ad.parentElement(a8)}}if(a7===null||(a7.nodeName=="HTML"&&ad.isHtmlNamespace(a6(a7).documentElement)&&ad.isHtmlNamespace(a7))){a7=ba.createElement("body")}else{a7=a7.cloneNode(false)}a7.innerHTML=a9;return ad.fragmentFromNodeChildren(a7)}:function(a8){var a9=aW(this);var a7=a9.createElement("body");a7.innerHTML=a8;return ad.fragmentFromNodeChildren(a7)};function al(a9,a7){M(a9);var bd=a9.startContainer,bc=a9.startOffset,ba=a9.endContainer,a8=a9.endOffset;var bb=(bd===ba);if(aw(ba)&&a8>0&&a8<ba.length){a1(ba,a8,a7)}if(aw(bd)&&bc>0&&bc<bd.length){bd=a1(bd,bc,a7);if(bb){a8-=bc;ba=bd}else{if(ba==bd.parentNode&&a8>=O(bd)){a8++}}bc=0}a9.setStartAndEnd(bd,bc,ba,a8)}function Q(a8){M(a8);var a7=a8.commonAncestorContainer.parentNode.cloneNode(false);a7.appendChild(a8.cloneContents());return a7.innerHTML}var aG=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var aK=0,aQ=1,X=2,R=3;var aH=0,aI=1,aR=2,aB=3;aT.extend(aa.rangePrototype,{compareBoundaryPoints:function(bc,a9){M(this);aL(this.startContainer,a9.startContainer);var be,a8,bd,a7;var bb=(bc==R||bc==aK)?"start":"end";var ba=(bc==aQ||bc==aK)?"start":"end";be=this[bb+"Container"];a8=this[bb+"Offset"];bd=a9[ba+"Container"];a7=a9[ba+"Offset"];return aV(be,a8,bd,a7)},insertNode:function(a8){M(this);N(a8,ak);ay(this.startContainer);if(av(a8,this.startContainer)){throw new aJ("HIERARCHY_REQUEST_ERR")}var a7=P(a8,this.startContainer,this.startOffset);this.setStartBefore(a7)},cloneContents:function(){M(this);var a9,a8;if(this.collapsed){return aW(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&aw(this.startContainer)){a9=this.startContainer.cloneNode(true);a9.data=a9.data.slice(this.startOffset,this.endOffset);a8=aW(this).createDocumentFragment();a8.appendChild(a9);return a8}else{var a7=new ag(this,true);a9=ab(a7);a7.detach()}return a9}},canSurroundContents:function(){M(this);ay(this.startContainer);ay(this.endContainer);var a7=new ag(this,true);var a8=(a7._first&&(aP(a7._first,this))||(a7._last&&aP(a7._last,this)));a7.detach();return !a8},surroundContents:function(a8){N(a8,a4);if(!this.canSurroundContents()){throw new aJ("INVALID_STATE_ERR")}var a7=this.extractContents();if(a8.hasChildNodes()){while(a8.lastChild){a8.removeChild(a8.lastChild)}}P(a8,this.startContainer,this.startOffset);a8.appendChild(a7);this.selectNode(a8)},cloneRange:function(){M(this);var a7=new am(aW(this));var a8=aG.length,a9;while(a8--){a9=aG[a8];a7[a9]=this[a9]}return a7},toString:function(){M(this);var a9=this.startContainer;if(a9===this.endContainer&&aw(a9)){return(a9.nodeType==3||a9.nodeType==4)?a9.data.slice(this.startOffset,this.endOffset):""}else{var a7=[],a8=new ag(this,true);aX(a8,function(ba){if(ba.nodeType==3||ba.nodeType==4){a7.push(ba.data)}});a8.detach();return a7.join("")}},compareNode:function(a9){M(this);var a8=a9.parentNode;var bb=O(a9);if(!a8){throw new aJ("NOT_FOUND_ERR")}var ba=this.comparePoint(a8,bb),a7=this.comparePoint(a8,bb+1);if(ba<0){return(a7>0)?aR:aH}else{return(a7>0)?aI:aB}},comparePoint:function(a7,a8){M(this);aF(a7,"HIERARCHY_REQUEST_ERR");aL(a7,this.startContainer);if(aV(a7,a8,this.startContainer,this.startOffset)<0){return -1}else{if(aV(a7,a8,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:af,toHtml:function(){return Q(this)},intersectsNode:function(ba,a7){M(this);aF(ba,"NOT_FOUND_ERR");if(a6(ba)!==aW(this)){return false}var a9=ba.parentNode,bc=O(ba);aF(a9,"NOT_FOUND_ERR");var bb=aV(a9,bc,this.endContainer,this.endOffset),a8=aV(a9,bc+1,this.startContainer,this.startOffset);return a7?bb<=0&&a8>=0:bb<0&&a8>0},isPointInRange:function(a7,a8){M(this);aF(a7,"HIERARCHY_REQUEST_ERR");aL(a7,this.startContainer);return(aV(a7,a8,this.startContainer,this.startOffset)>=0)&&(aV(a7,a8,this.endContainer,this.endOffset)<=0)},intersectsRange:function(a7){return U(this,a7,false)},intersectsOrTouchesRange:function(a7){return U(this,a7,true)},intersection:function(a7){if(this.intersectsRange(a7)){var ba=aV(this.startContainer,this.startOffset,a7.startContainer,a7.startOffset),a8=aV(this.endContainer,this.endOffset,a7.endContainer,a7.endOffset);var a9=this.cloneRange();if(ba==-1){a9.setStart(a7.startContainer,a7.startOffset)}if(a8==1){a9.setEnd(a7.endContainer,a7.endOffset)}return a9}return null},union:function(a7){if(this.intersectsOrTouchesRange(a7)){var a8=this.cloneRange();if(aV(a7.startContainer,a7.startOffset,this.startContainer,this.startOffset)==-1){a8.setStart(a7.startContainer,a7.startOffset)}if(aV(a7.endContainer,a7.endOffset,this.endContainer,this.endOffset)==1){a8.setEnd(a7.endContainer,a7.endOffset)}return a8}else{throw new aJ("Ranges do not intersect")}},containsNode:function(a8,a7){if(a7){return this.intersectsNode(a8,false)}else{return this.compareNode(a8)==aB}},containsNodeContents:function(a7){return this.comparePoint(a7,0)>=0&&this.comparePoint(a7,az(a7))<=0},containsRange:function(a7){var a8=this.intersection(a7);return a8!==null&&a7.equals(a8)},containsNodeText:function(a9){var ba=this.cloneRange();ba.selectNode(a9);var a8=ba.getNodes([3]);if(a8.length>0){ba.setStart(a8[0],0);var a7=a8.pop();ba.setEnd(a7,a7.length);return this.containsRange(ba)}else{return this.containsNodeContents(a9)}},getNodes:function(a7,a8){M(this);return aA(this,a7,a8)},getDocument:function(){return aW(this)},collapseBefore:function(a7){this.setEndBefore(a7);this.collapse(false)},collapseAfter:function(a7){this.setStartAfter(a7);this.collapse(true)},getBookmark:function(a7){var bb=aW(this);var a9=aa.createRange(bb);a7=a7||ad.getBody(bb);a9.selectNodeContents(a7);var ba=this.intersection(a9);var bc=0,a8=0;if(ba){a9.setEnd(ba.startContainer,ba.startOffset);bc=a9.toString().length;a8=bc+ba.toString().length}return{start:bc,end:a8,containerNode:a7}},moveToBookmark:function(be){var ba=be.containerNode;var a7=0;this.setStart(ba,0);this.collapse(true);var bc=[ba],a8,a9=false,bf=false;var bd,bb,bg;while(!bf&&(a8=bc.pop())){if(a8.nodeType==3){bd=a7+a8.length;if(!a9&&be.start>=a7&&be.start<=bd){this.setStart(a8,be.start-a7);a9=true}if(a9&&be.end>=a7&&be.end<=bd){this.setEnd(a8,be.end-a7);bf=true}a7=bd}else{bg=a8.childNodes;bb=bg.length;while(bb--){bc.push(bg[bb])}}}},getName:function(){return"DomRange"},equals:function(a7){return am.rangesEqual(this,a7)},isValid:function(){return an(this)},inspect:function(){return a0(this)},detach:function(){}});function ao(a7){a7.START_TO_START=aK;a7.START_TO_END=aQ;a7.END_TO_END=X;a7.END_TO_START=R;a7.NODE_BEFORE=aH;a7.NODE_AFTER=aI;a7.NODE_BEFORE_AND_AFTER=aR;a7.NODE_INSIDE=aB}function ac(a7){ao(a7);ao(a7.prototype)}function aZ(a7,a8){return function(){M(this);var be=this.startContainer,bd=this.startOffset,a9=this.commonAncestorContainer;var bb=new ag(this,true);var bc,bf;if(be!==a9){bc=aM(be,a9,true);bf=T(bc);be=bf.node;bd=bf.offset}aX(bb,ay);bb.reset();var ba=a7(bb);bb.detach();a8(this,be,bd,be,bd);return ba}}function W(a8,bc){function bb(be,bd){return function(bf){N(bf,aC);N(ae(bf),aU);var bg=(be?ai:T)(bf);(bd?a7:ba)(this,bg.node,bg.offset)}}function a7(be,bg,bh){var bf=be.endContainer,bd=be.endOffset;if(bg!==be.startContainer||bh!==be.startOffset){if(ae(bg)!=ae(bf)||aV(bg,bh,bf,bd)==1){bf=bg;bd=bh}bc(be,bg,bh,bf,bd)}}function ba(bd,be,bh){var bg=bd.startContainer,bf=bd.startOffset;if(be!==bd.endContainer||bh!==bd.endOffset){if(ae(be)!=ae(bg)||aV(be,bh,bg,bf)==-1){bg=be;bf=bh}bc(bd,bg,bf,be,bh)}}var a9=function(){};a9.prototype=aa.rangePrototype;a8.prototype=new a9();aT.extend(a8.prototype,{setStart:function(bd,be){Z(bd,true);aD(bd,be);a7(this,bd,be)},setEnd:function(bd,be){Z(bd,true);aD(bd,be);ba(this,bd,be)},setStartAndEnd:function(){var bf=arguments;var bh=bf[0],bg=bf[1],be=bh,bd=bg;switch(bf.length){case 3:bd=bf[2];break;case 4:be=bf[2];bd=bf[3];break}bc(this,bh,bg,be,bd)},setBoundary:function(be,bf,bd){this["set"+(bd?"Start":"End")](be,bf)},setStartBefore:bb(true,true),setStartAfter:bb(false,true),setEndBefore:bb(true,false),setEndAfter:bb(false,false),collapse:function(bd){M(this);if(bd){bc(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{bc(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(bd){Z(bd,true);bc(this,bd,0,bd,az(bd))},selectNode:function(be){Z(be,false);N(be,aC);var bf=ai(be),bd=T(be);bc(this,bf.node,bf.offset,bd.node,bd.offset)},extractContents:aZ(aS,bc),deleteContents:aZ(ax,bc),canSurroundContents:function(){M(this);ay(this.startContainer);ay(this.endContainer);var bd=new ag(this,true);var be=(bd._first&&aP(bd._first,this)||(bd._last&&aP(bd._last,this)));bd.detach();return !be},splitBoundaries:function(){al(this)},splitBoundariesPreservingPositions:function(bd){al(this,bd)},normalizeBoundaries:function(){M(this);var bk=this.startContainer,bf=this.startOffset,bj=this.endContainer,bd=this.endOffset;var bg=function(bn){var bm=bn.nextSibling;if(bm&&bm.nodeType==bn.nodeType){bj=bn;bd=bn.length;bn.appendData(bm.data);aY(bm)}};var bl=function(bo){var bn=bo.previousSibling;if(bn&&bn.nodeType==bo.nodeType){bk=bo;var bm=bo.length;bf=bn.length;bo.insertData(0,bn.data);aY(bn);if(bk==bj){bd+=bf;bj=bk}else{if(bj==bo.parentNode){var bp=O(bo);if(bd==bp){bj=bo;bd=bm}else{if(bd>bp){bd--}}}}}};var bi=true;if(aw(bj)){if(bj.length==bd){bg(bj)}}else{if(bd>0){var bh=bj.childNodes[bd-1];if(bh&&aw(bh)){bg(bh)}}bi=!this.collapsed}if(bi){if(aw(bk)){if(bf==0){bl(bk)}}else{if(bf<bk.childNodes.length){var be=bk.childNodes[bf];if(be&&aw(be)){bl(be)}}}}else{bk=bj;bf=bd}bc(this,bk,bf,bj,bd)},collapseToPoint:function(bd,be){Z(bd,true);aD(bd,be);this.setStartAndEnd(bd,be)}});ac(a8)}function ap(a7){a7.collapsed=(a7.startContainer===a7.endContainer&&a7.startOffset===a7.endOffset);a7.commonAncestorContainer=a7.collapsed?a7.startContainer:ad.getCommonAncestor(a7.startContainer,a7.endContainer)}function aO(a8,ba,a7,bb,a9){a8.startContainer=ba;a8.startOffset=a7;a8.endContainer=bb;a8.endOffset=a9;a8.document=ad.getDocument(ba);ap(a8)}function am(a7){this.startContainer=a7;this.startOffset=0;this.endContainer=a7;this.endOffset=0;this.document=a7;ap(this)}W(am,aO);aT.extend(am,{rangeProperties:aG,RangeIterator:ag,copyComparisonConstants:ac,createPrototypeRange:W,inspect:a0,toHtml:Q,getRangeDocument:aW,rangesEqual:function(a8,a7){return a8.startContainer===a7.startContainer&&a8.startOffset===a7.startOffset&&a8.endContainer===a7.endContainer&&a8.endOffset===a7.endOffset}});aa.DomRange=am});h.createCoreModule("WrappedRange",["DomRange"],function(Y,Q){var M,N;var U=Y.dom;var V=Y.util;var P=U.DomPosition;var aa=Y.DomRange;var W=U.getBody;var ac=U.getContentDocument;var X=U.isCharacterDataNode;if(Y.features.implementsDomRange){(function(){var ag;var an=aa.rangeProperties;function ad(ap){var aq=an.length,ar;while(aq--){ar=an[aq];ap[ar]=ap.nativeRange[ar]}ap.collapsed=(ap.startContainer===ap.endContainer&&ap.startOffset===ap.endOffset)}function ai(ar,av,aq,aw,at){var ap=(ar.startContainer!==av||ar.startOffset!=aq);var ax=(ar.endContainer!==aw||ar.endOffset!=at);var au=!ar.equals(ar.nativeRange);if(ap||ax||au){ar.setEnd(aw,at);ar.setStart(av,aq)}}var af;M=function(ap){if(!ap){throw Q.createError("WrappedRange: Range must be specified")}this.nativeRange=ap;ad(this)};aa.createPrototypeRange(M,ai);ag=M.prototype;ag.selectNode=function(ap){this.nativeRange.selectNode(ap);ad(this)};ag.cloneContents=function(){return this.nativeRange.cloneContents()};ag.surroundContents=function(ap){this.nativeRange.surroundContents(ap);ad(this)};ag.collapse=function(ap){this.nativeRange.collapse(ap);ad(this)};ag.cloneRange=function(){return new M(this.nativeRange.cloneRange())};ag.refresh=function(){ad(this)};ag.toString=function(){return this.nativeRange.toString()};var am=document.createTextNode("test");W(document).appendChild(am);var aj=document.createRange();aj.setStart(am,0);aj.setEnd(am,0);try{aj.setStart(am,1);ag.setStart=function(ap,aq){this.nativeRange.setStart(ap,aq);ad(this)};ag.setEnd=function(ap,aq){this.nativeRange.setEnd(ap,aq);ad(this)};af=function(ap){return function(aq){this.nativeRange[ap](aq);ad(this)}}}catch(al){ag.setStart=function(aq,ar){try{this.nativeRange.setStart(aq,ar)}catch(ap){this.nativeRange.setEnd(aq,ar);this.nativeRange.setStart(aq,ar)}ad(this)};ag.setEnd=function(aq,ar){try{this.nativeRange.setEnd(aq,ar)}catch(ap){this.nativeRange.setStart(aq,ar);this.nativeRange.setEnd(aq,ar)}ad(this)};af=function(ap,aq){return function(at){try{this.nativeRange[ap](at)}catch(ar){this.nativeRange[aq](at);this.nativeRange[ap](at)}ad(this)}}}ag.setStartBefore=af("setStartBefore","setEndBefore");ag.setStartAfter=af("setStartAfter","setEndAfter");ag.setEndBefore=af("setEndBefore","setStartBefore");ag.setEndAfter=af("setEndAfter","setStartAfter");ag.selectNodeContents=function(ap){this.setStartAndEnd(ap,0,U.getNodeLength(ap))};aj.selectNodeContents(am);aj.setEnd(am,3);var ao=document.createRange();ao.selectNodeContents(am);ao.setEnd(am,4);ao.setStart(am,2);if(aj.compareBoundaryPoints(aj.START_TO_END,ao)==-1&&aj.compareBoundaryPoints(aj.END_TO_START,ao)==1){ag.compareBoundaryPoints=function(aq,ap){ap=ap.nativeRange||ap;if(aq==ap.START_TO_END){aq=ap.END_TO_START}else{if(aq==ap.END_TO_START){aq=ap.START_TO_END}}return this.nativeRange.compareBoundaryPoints(aq,ap)}}else{ag.compareBoundaryPoints=function(aq,ap){return this.nativeRange.compareBoundaryPoints(aq,ap.nativeRange||ap)}}var ae=document.createElement("div");ae.innerHTML="123";var ah=ae.firstChild;var ak=W(document);ak.appendChild(ae);aj.setStart(ah,1);aj.setEnd(ah,2);aj.deleteContents();if(ah.data=="13"){ag.deleteContents=function(){this.nativeRange.deleteContents();ad(this)};ag.extractContents=function(){var ap=this.nativeRange.extractContents();ad(this);return ap}}else{}ak.removeChild(ae);ak=null;if(V.isHostMethod(aj,"createContextualFragment")){ag.createContextualFragment=function(ap){return this.nativeRange.createContextualFragment(ap)}}W(document).removeChild(am);ag.getName=function(){return"WrappedRange"};Y.WrappedRange=M;Y.createNativeRange=function(ap){ap=ac(ap,Q,"createNativeRange");return ap.createRange()}})()}if(Y.features.implementsTextRange){var R=function(ai){var ag=ai.parentElement();var ae=ai.duplicate();ae.collapse(true);var ah=ae.parentElement();ae=ai.duplicate();ae.collapse(false);var af=ae.parentElement();var ad=(ah==af)?ah:U.getCommonAncestor(ah,af);return ad==ag?ad:U.getCommonAncestor(ag,ad)};var O=function(ad){return ad.compareEndPoints("StartToEnd",ad)==0};var S=function(ad,ap,an,ae,ah){var aq=ad.duplicate();aq.collapse(an);var af=aq.parentElement();if(!U.isOrIsAncestorOf(ap,af)){af=ap}if(!af.canHaveHTML){var am=new P(af.parentNode,U.getNodeIndex(af));return{boundaryPosition:am,nodeInfo:{nodeIndex:am.offset,containerElement:am.node}}}var ag=U.getDocument(af).createElement("span");if(ag.parentNode){U.removeNode(ag)}var az,ax=an?"StartToStart":"StartToEnd";var ar,ai,ao,at;var ak=(ah&&ah.containerElement==af)?ah.nodeIndex:0;var au=af.childNodes.length;var aj=au;var aw=aj;while(true){if(aw==au){af.appendChild(ag)}else{af.insertBefore(ag,af.childNodes[aw])}aq.moveToElementText(ag);az=aq.compareEndPoints(ax,ad);if(az==0||ak==aj){break}else{if(az==-1){if(aj==ak+1){break}else{ak=aw}}else{aj=(aj==ak+1)?ak:aw}}aw=Math.floor((ak+aj)/2);af.removeChild(ag)}at=ag.nextSibling;if(az==-1&&at&&X(at)){aq.setEndPoint(an?"EndToStart":"EndToEnd",ad);var al;if(/[\r\n]/.test(at.data)){var av=aq.duplicate();var ay=av.text.replace(/\r\n/g,"\r").length;al=av.moveStart("character",ay);while((az=av.compareEndPoints("StartToEnd",av))==-1){al++;av.moveStart("character",1)}}else{al=aq.text.length}ao=new P(at,al)}else{ar=(ae||!an)&&ag.previousSibling;ai=(ae||an)&&ag.nextSibling;if(ai&&X(ai)){ao=new P(ai,0)}else{if(ar&&X(ar)){ao=new P(ar,ar.data.length)}else{ao=new P(af,U.getNodeIndex(ag))}}}U.removeNode(ag);return{boundaryPosition:ao,nodeInfo:{nodeIndex:aw,containerElement:af}}};var ab=function(ad,af){var ag,aj,ah=ad.offset;var ak=U.getDocument(ad.node);var ae,al,am=W(ak).createTextRange();var ai=X(ad.node);if(ai){ag=ad.node;aj=ag.parentNode}else{al=ad.node.childNodes;ag=(ah<al.length)?al[ah]:null;aj=ad.node}ae=ak.createElement("span");ae.innerHTML="&#feff;";if(ag){aj.insertBefore(ae,ag)}else{aj.appendChild(ae)}am.moveToElementText(ae);am.collapse(!af);aj.removeChild(ae);if(ai){am[af?"moveStart":"moveEnd"]("character",ah)}return am};N=function(ad){this.textRange=ad;this.refresh()};N.prototype=new aa(document);N.prototype.refresh=function(){var ag,ad,af;var ae=R(this.textRange);if(O(this.textRange)){ad=ag=S(this.textRange,ae,true,true).boundaryPosition}else{af=S(this.textRange,ae,true,false);ag=af.boundaryPosition;ad=S(this.textRange,ae,false,false,af.nodeInfo).boundaryPosition}this.setStart(ag.node,ag.offset);this.setEnd(ad.node,ad.offset)};N.prototype.getName=function(){return"WrappedTextRange"};aa.copyComparisonConstants(N);var Z=function(ad){if(ad.collapsed){return ab(new P(ad.startContainer,ad.startOffset),true)}else{var ag=ab(new P(ad.startContainer,ad.startOffset),true);var af=ab(new P(ad.endContainer,ad.endOffset),false);var ae=W(aa.getRangeDocument(ad)).createTextRange();ae.setEndPoint("StartToStart",ag);ae.setEndPoint("EndToEnd",af);return ae}};N.rangeToTextRange=Z;N.prototype.toTextRange=function(){return Z(this)};Y.WrappedTextRange=N;if(!Y.features.implementsDomRange||Y.config.preferTextRange){var T=(function(ad){return ad("return this;")()})(Function);if(typeof T.Range=="undefined"){T.Range=N}Y.createNativeRange=function(ad){ad=ac(ad,Q,"createNativeRange");return W(ad).createTextRange()};Y.WrappedRange=N}}Y.createRange=function(ad){ad=ac(ad,Q,"createRange");return new Y.WrappedRange(Y.createNativeRange(ad))};Y.createRangyRange=function(ad){ad=ac(ad,Q,"createRangyRange");return new aa(ad)};Y.createIframeRange=function(ad){Q.deprecationNotice("createIframeRange()","createRange(iframeEl)");return Y.createRange(ad)};Y.createIframeRangyRange=function(ad){Q.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return Y.createRangyRange(ad)};Y.addShimListener(function(ae){var ad=ae.document;if(typeof ad.createRange=="undefined"){ad.createRange=function(){return Y.createRange(ad)}}ad=ae=null})});h.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(V,P){V.config.checkSelectionRanges=true;var av="boolean";var ay="number";var O=V.dom;var aa=V.util;var aJ=aa.isHostMethod;var aN=V.DomRange;var R=V.WrappedRange;var aI=V.DOMException;var ap=O.DomPosition;var aF;var ac;var Z=V.features;var aV="Control";var aU=O.getDocument;var aT=O.getBody;var aA=aN.rangesEqual;function S(aX){return(typeof aX=="string")?/^backward(s)?$/i.test(aX):!!aX}function al(aZ,aX){if(!aZ){return window}else{if(O.isWindow(aZ)){return aZ}else{if(aZ instanceof ar){return aZ.win}else{var aY=O.getContentDocument(aZ,P,aX);return O.getWindow(aY)}}}}function ab(aX){return al(aX,"getWinSelection").getSelection()}function af(aX){return al(aX,"getDocSelection").document.selection}function aS(aX){var aY=false;if(aX.anchorNode){aY=(O.comparePoints(aX.anchorNode,aX.anchorOffset,aX.focusNode,aX.focusOffset)==1)}return aY}var aQ=aJ(window,"getSelection"),aH=aa.isHostObject(document,"selection");Z.implementsWinGetSelection=aQ;Z.implementsDocSelection=aH;var ai=aH&&(!aQ||V.config.preferTextRange);if(ai){aF=af;V.isSelectionValid=function(aY){var aZ=al(aY,"isSelectionValid").document,aX=aZ.selection;return(aX.type!="None"||aU(aX.createRange().parentElement())==aZ)}}else{if(aQ){aF=ab;V.isSelectionValid=function(){return true}}else{P.fail("Neither document.selection or window.getSelection() detected.");return false}}V.getNativeSelection=aF;var aG=aF();if(!aG){P.fail("Native selection was null (possibly issue 138?)");return false}var at=V.createNativeRange(document);var au=aT(document);var aD=aa.areHostProperties(aG,["anchorNode","focusNode","anchorOffset","focusOffset"]);Z.selectionHasAnchorAndFocus=aD;var ae=aJ(aG,"extend");Z.selectionHasExtend=ae;var aW=(typeof aG.rangeCount==ay);Z.selectionHasRangeCount=aW;var aM=false;var aK=true;var am=ae?function(a0,aX){var aZ=aN.getRangeDocument(aX);var aY=V.createRange(aZ);aY.collapseToPoint(aX.endContainer,aX.endOffset);a0.addRange(aC(aY));a0.extend(aX.startContainer,aX.startOffset)}:null;if(aa.areHostMethods(aG,["addRange","getRangeAt","removeAllRanges"])&&typeof aG.rangeCount==ay&&Z.implementsDomRange){(function(){var aY=window.getSelection();if(aY){var a2=aY.rangeCount;var a4=(a2>1);var a5=[];var a7=aS(aY);for(var a3=0;a3<a2;++a3){a5[a3]=aY.getRangeAt(a3)}var a0=O.createTestElement(document,"",false);var a1=a0.appendChild(document.createTextNode("\u00a0\u00a0\u00a0"));var aZ=document.createRange();aZ.setStart(a1,1);aZ.collapse(true);aY.removeAllRanges();aY.addRange(aZ);aK=(aY.rangeCount==1);aY.removeAllRanges();if(!a4){var a6=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(a6&&parseInt(a6[1])>=36){aM=false}else{var aX=aZ.cloneRange();aZ.setStart(a1,0);aX.setEnd(a1,3);aX.setStart(a1,2);aY.addRange(aZ);aY.addRange(aX);aM=(aY.rangeCount==2)}}O.removeNode(a0);aY.removeAllRanges();for(a3=0;a3<a2;++a3){if(a3==0&&a7){if(am){am(aY,a5[a3])}else{V.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");aY.addRange(a5[a3])}}else{aY.addRange(a5[a3])}}}})()}Z.selectionSupportsMultipleRanges=aM;Z.collapsedNonEditableSelectionsSupported=aK;var U=false,X;if(au&&aJ(au,"createControlRange")){X=au.createControlRange();if(aa.areHostProperties(X,["item","add"])){U=true}}Z.implementsControlRange=U;if(aD){ac=function(aX){return aX.anchorNode===aX.focusNode&&aX.anchorOffset===aX.focusOffset}}else{ac=function(aX){return aX.rangeCount?aX.getRangeAt(aX.rangeCount-1).collapsed:false}}function N(aZ,aX,a0){var aY=a0?"end":"start",a1=a0?"start":"end";aZ.anchorNode=aX[aY+"Container"];aZ.anchorOffset=aX[aY+"Offset"];aZ.focusNode=aX[a1+"Container"];aZ.focusOffset=aX[a1+"Offset"]}function ak(aY){var aX=aY.nativeSelection;aY.anchorNode=aX.anchorNode;aY.anchorOffset=aX.anchorOffset;aY.focusNode=aX.focusNode;aY.focusOffset=aX.focusOffset}function az(aX){aX.anchorNode=aX.focusNode=null;aX.anchorOffset=aX.focusOffset=0;aX.rangeCount=0;aX.isCollapsed=true;aX._ranges.length=0}function aC(aX){var aY;if(aX instanceof aN){aY=V.createNativeRange(aX.getDocument());aY.setEnd(aX.endContainer,aX.endOffset);aY.setStart(aX.startContainer,aX.startOffset)}else{if(aX instanceof R){aY=aX.nativeRange}else{if(Z.implementsDomRange&&(aX instanceof O.getWindow(aX.startContainer).Range)){aY=aX}}}return aY}function Y(aZ){if(!aZ.length||aZ[0].nodeType!=1){return false}for(var aY=1,aX=aZ.length;aY<aX;++aY){if(!O.isAncestorOf(aZ[0],aZ[aY])){return false}}return true}function aE(aY){var aX=aY.getNodes();if(!Y(aX)){throw P.createError("getSingleElementFromRange: range "+aY.inspect()+" did not consist of a single element")}return aX[0]}function ax(aX){return !!aX&&typeof aX.text!="undefined"}function aB(aZ,aY){var aX=new R(aY);aZ._ranges=[aX];N(aZ,aX,false);aZ.rangeCount=1;aZ.isCollapsed=aX.collapsed}function ah(a0){a0._ranges.length=0;if(a0.docSelection.type=="None"){az(a0)}else{var aZ=a0.docSelection.createRange();if(ax(aZ)){aB(a0,aZ)}else{a0.rangeCount=aZ.length;var aX,a1=aU(aZ.item(0));for(var aY=0;aY<a0.rangeCount;++aY){aX=V.createRange(a1);aX.selectNode(aZ.item(aY));a0._ranges.push(aX)}a0.isCollapsed=a0.rangeCount==1&&a0._ranges[0].collapsed;N(a0,a0._ranges[a0.rangeCount-1],false)}}}function ao(aY,a1){var aZ=aY.docSelection.createRange();var aX=aE(a1);var a5=aU(aZ.item(0));var a2=aT(a5).createControlRange();for(var a0=0,a3=aZ.length;a0<a3;++a0){a2.add(aZ.item(a0))}try{a2.add(aX)}catch(a4){throw P.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a2.select();ah(aY)}var ad;if(aJ(aG,"getRangeAt")){ad=function(aZ,aX){try{return aZ.getRangeAt(aX)}catch(aY){return null}}}else{if(aD){ad=function(aY){var aZ=aU(aY.anchorNode);var aX=V.createRange(aZ);aX.setStartAndEnd(aY.anchorNode,aY.anchorOffset,aY.focusNode,aY.focusOffset);if(aX.collapsed!==this.isCollapsed){aX.setStartAndEnd(aY.focusNode,aY.focusOffset,aY.anchorNode,aY.anchorOffset)}return aX}}}function ar(aX,aZ,aY){this.nativeSelection=aX;this.docSelection=aZ;this._ranges=[];this.win=aY;this.refresh()}ar.prototype=V.selectionPrototype;function an(aX){aX.win=aX.anchorNode=aX.focusNode=aX._ranges=null;aX.rangeCount=aX.anchorOffset=aX.focusOffset=0;aX.detached=true}var aR=[];function aL(a1,a0){var aX=aR.length,aY,aZ;while(aX--){aY=aR[aX];aZ=aY.selection;if(a0=="deleteAll"){an(aZ)}else{if(aY.win==a1){if(a0=="delete"){aR.splice(aX,1);return true}else{return aZ}}}}if(a0=="deleteAll"){aR.length=0}return null}var aj=function(aZ){if(aZ&&aZ instanceof ar){aZ.refresh();return aZ}aZ=al(aZ,"getNativeSelection");var aY=aL(aZ);var aX=aF(aZ),a0=aH?af(aZ):null;if(aY){aY.nativeSelection=aX;aY.docSelection=a0;aY.refresh()}else{aY=new ar(aX,a0,aZ);aR.push({win:aZ,selection:aY})}return aY};V.getSelection=aj;V.getIframeSelection=function(aX){P.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return V.getSelection(O.getIframeWindow(aX))};var M=ar.prototype;function W(a3,aY){var a4=aU(aY[0].startContainer);var a1=aT(a4).createControlRange();for(var a0=0,a2,aX=aY.length;a0<aX;++a0){a2=aE(aY[a0]);try{a1.add(a2)}catch(aZ){throw P.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a1.select();ah(a3)}if(!ai&&aD&&aa.areHostMethods(aG,["removeAllRanges","addRange"])){M.removeAllRanges=function(){this.nativeSelection.removeAllRanges();az(this)};var Q=function(aY,aX){am(aY.nativeSelection,aX);aY.refresh()};if(aW){M.addRange=function(aY,a2){if(U&&aH&&this.docSelection.type==aV){ao(this,aY)}else{if(S(a2)&&ae){Q(this,aY)}else{var a0;if(aM){a0=this.rangeCount}else{this.removeAllRanges();a0=0}var aX=aC(aY).cloneRange();try{this.nativeSelection.addRange(aX)}catch(aZ){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==a0+1){if(V.config.checkSelectionRanges){var a1=ad(this.nativeSelection,this.rangeCount-1);if(a1&&!aA(a1,aY)){aY=new R(a1)}}this._ranges[this.rangeCount-1]=aY;N(this,aY,T(this.nativeSelection));this.isCollapsed=ac(this)}else{this.refresh()}}}}}else{M.addRange=function(aX,aY){if(S(aY)&&ae){Q(this,aX)}else{this.nativeSelection.addRange(aC(aX));this.refresh()}}}M.setRanges=function(aY){if(U&&aH&&aY.length>1){W(this,aY)}else{this.removeAllRanges();for(var aZ=0,aX=aY.length;aZ<aX;++aZ){this.addRange(aY[aZ])}}}}else{if(aJ(aG,"empty")&&aJ(at,"select")&&U&&ai){M.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a0;if(this.anchorNode){a0=aU(this.anchorNode)}else{if(this.docSelection.type==aV){var aY=this.docSelection.createRange();if(aY.length){a0=aU(aY.item(0))}}}if(a0){var aZ=aT(a0).createTextRange();aZ.select();this.docSelection.empty()}}}catch(aX){}az(this)};M.addRange=function(aX){if(this.docSelection.type==aV){ao(this,aX)}else{V.WrappedTextRange.rangeToTextRange(aX).select();this._ranges[0]=aX;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;N(this,aX,false)}};M.setRanges=function(aX){this.removeAllRanges();var aY=aX.length;if(aY>1){W(this,aX)}else{if(aY){this.addRange(aX[0])}}}}else{P.fail("No means of selecting a Range or TextRange was found");return false}}M.getRangeAt=function(aX){if(aX<0||aX>=this.rangeCount){throw new aI("INDEX_SIZE_ERR")}else{return this._ranges[aX].cloneRange()}};var aw;if(ai){aw=function(aY){var aX;if(V.isSelectionValid(aY.win)){aX=aY.docSelection.createRange()}else{aX=aT(aY.win.document).createTextRange();aX.collapse(true)}if(aY.docSelection.type==aV){ah(aY)}else{if(ax(aX)){aB(aY,aX)}else{az(aY)}}}}else{if(aJ(aG,"getRangeAt")&&typeof aG.rangeCount==ay){aw=function(aZ){if(U&&aH&&aZ.docSelection.type==aV){ah(aZ)}else{aZ._ranges.length=aZ.rangeCount=aZ.nativeSelection.rangeCount;if(aZ.rangeCount){for(var aY=0,aX=aZ.rangeCount;aY<aX;++aY){aZ._ranges[aY]=new V.WrappedRange(aZ.nativeSelection.getRangeAt(aY))}N(aZ,aZ._ranges[aZ.rangeCount-1],T(aZ.nativeSelection));aZ.isCollapsed=ac(aZ)}else{az(aZ)}}}}else{if(aD&&typeof aG.isCollapsed==av&&typeof at.collapsed==av&&Z.implementsDomRange){aw=function(aZ){var aX,aY=aZ.nativeSelection;if(aY.anchorNode){aX=ad(aY,0);aZ._ranges=[aX];aZ.rangeCount=1;ak(aZ);aZ.isCollapsed=ac(aZ)}else{az(aZ)}}}else{P.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}M.refresh=function(aY){var aX=aY?this._ranges.slice(0):null;var a0=this.anchorNode,a1=this.anchorOffset;aw(this);if(aY){var aZ=aX.length;if(aZ!=this._ranges.length){return true}if(this.anchorNode!=a0||this.anchorOffset!=a1){return true}while(aZ--){if(!aA(aX[aZ],this._ranges[aZ])){return true}}return false}};var aq=function(a1,aZ){var aY=a1.getAllRanges();a1.removeAllRanges();for(var a0=0,aX=aY.length;a0<aX;++a0){if(!aA(aZ,aY[a0])){a1.addRange(aY[a0])}}if(!a1.rangeCount){az(a1)}};if(U&&aH){M.removeRange=function(a1){if(this.docSelection.type==aV){var aZ=this.docSelection.createRange();var aX=aE(a1);var a5=aU(aZ.item(0));var a3=aT(a5).createControlRange();var aY,a4=false;for(var a0=0,a2=aZ.length;a0<a2;++a0){aY=aZ.item(a0);if(aY!==aX||a4){a3.add(aZ.item(a0))}else{a4=true}}a3.select();ah(this)}else{aq(this,a1)}}}else{M.removeRange=function(aX){aq(this,aX)}}var T;if(!ai&&aD&&Z.implementsDomRange){T=aS;M.isBackward=function(){return T(this)}}else{T=M.isBackward=function(){return false}}M.isBackwards=M.isBackward;M.toString=function(){var aZ=[];for(var aY=0,aX=this.rangeCount;aY<aX;++aY){aZ[aY]=""+this._ranges[aY]}return aZ.join("")};function aO(aY,aX){if(aY.win.document!=aU(aX)){throw new aI("WRONG_DOCUMENT_ERR")}}M.collapse=function(aY,aZ){aO(this,aY);var aX=V.createRange(aY);aX.collapseToPoint(aY,aZ);this.setSingleRange(aX);this.isCollapsed=true};M.collapseToStart=function(){if(this.rangeCount){var aX=this._ranges[0];this.collapse(aX.startContainer,aX.startOffset)}else{throw new aI("INVALID_STATE_ERR")}};M.collapseToEnd=function(){if(this.rangeCount){var aX=this._ranges[this.rangeCount-1];this.collapse(aX.endContainer,aX.endOffset)}else{throw new aI("INVALID_STATE_ERR")}};M.selectAllChildren=function(aY){aO(this,aY);var aX=V.createRange(aY);aX.selectNodeContents(aY);this.setSingleRange(aX)};M.deleteFromDocument=function(){if(U&&aH&&this.docSelection.type==aV){var a1=this.docSelection.createRange();var a0;while(a1.length){a0=a1.item(0);a1.remove(a0);O.removeNode(a0)}this.refresh()}else{if(this.rangeCount){var aY=this.getAllRanges();if(aY.length){this.removeAllRanges();for(var aZ=0,aX=aY.length;aZ<aX;++aZ){aY[aZ].deleteContents()}this.addRange(aY[aX-1])}}}};M.eachRange=function(a0,aZ){for(var aY=0,aX=this._ranges.length;aY<aX;++aY){if(a0(this.getRangeAt(aY))){return aZ}}};M.getAllRanges=function(){var aX=[];this.eachRange(function(aY){aX.push(aY)});return aX};M.setSingleRange=function(aX,aY){this.removeAllRanges();this.addRange(aX,aY)};M.callMethodOnEachRange=function(aX,aZ){var aY=[];this.eachRange(function(a0){aY.push(a0[aX].apply(a0,aZ))});return aY};function aP(aX){return function(aZ,a0){var aY;if(this.rangeCount){aY=this.getRangeAt(0);aY["set"+(aX?"Start":"End")](aZ,a0)}else{aY=V.createRange(this.win.document);aY.setStartAndEnd(aZ,a0)}this.setSingleRange(aY,this.isBackward())}}M.setStart=aP(true);M.setEnd=aP(false);V.rangePrototype.select=function(aX){aj(this.getDocument()).setSingleRange(this,aX)};M.changeEachRange=function(aY){var aX=[];var aZ=this.isBackward();this.eachRange(function(a0){aY(a0);aX.push(a0)});this.removeAllRanges();if(aZ&&aX.length==1){this.addRange(aX[0],"backward")}else{this.setRanges(aX)}};M.containsNode=function(aY,aX){return this.eachRange(function(aZ){return aZ.containsNode(aY,aX)},true)||false};M.getBookmark=function(aX){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[aX])}};M.moveToBookmark=function(a1){var aX=[];for(var a0=0,aZ,aY;aZ=a1.rangeBookmarks[a0++];){aY=V.createRange(this.win);aY.moveToBookmark(aZ);aX.push(aY)}if(a1.backward){this.setSingleRange(aX[0],"backward")}else{this.setRanges(aX)}};M.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};M.restoreRanges=function(aX){this.removeAllRanges();for(var aZ=0,aY;aY=aX.ranges[aZ];++aZ){this.addRange(aY,(aX.backward&&aZ==0))}};M.toHtml=function(){var aX=[];this.eachRange(function(aY){aX.push(aN.toHtml(aY))});return aX.join("")};if(Z.implementsTextRange){M.getNativeTextRange=function(){var aZ,aY;if((aZ=this.docSelection)){var aX=aZ.createRange();if(ax(aX)){return aX}else{throw P.createError("getNativeTextRange: selection is a control selection")}}else{if(this.rangeCount>0){return V.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw P.createError("getNativeTextRange: selection contains no range")}}}}function ag(a3){var a2=[];var a0=new ap(a3.anchorNode,a3.anchorOffset);var aY=new ap(a3.focusNode,a3.focusOffset);var aZ=(typeof a3.getName=="function")?a3.getName():"Selection";if(typeof a3.rangeCount!="undefined"){for(var a1=0,aX=a3.rangeCount;a1<aX;++a1){a2[a1]=aN.inspect(a3.getRangeAt(a1))}}return"["+aZ+"(Ranges: "+a2.join(", ")+")(anchor: "+a0.inspect()+", focus: "+aY.inspect()+"]"}M.getName=function(){return"WrappedSelection"};M.inspect=function(){return ag(this)};M.detach=function(){aL(this.win,"delete");an(this)};ar.detachAll=function(){aL(null,"deleteAll")};ar.inspect=ag;ar.isDirectionBackward=S;V.Selection=ar;V.selectionPrototype=M;V.addShimListener(function(aX){if(typeof aX.getSelection=="undefined"){aX.getSelection=function(){return aj(aX)}}aX=null})});var e=false;var J=function(M){if(!e){e=true;if(!h.initialized&&h.config.autoInitialize){I()}}};if(C){if(document.readyState=="complete"){J()}else{if(D(document,"addEventListener")){document.addEventListener("DOMContentLoaded",J,false)}i(window,"load",J)}}return h},this);